<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    .container {
      display: flex;
      justify-content: space-between;
    }
    .unit {
      width: 100px;
      height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      overflow-y: hidden;
      position: relative;
    }
    .hole {
      height: 50px;
      background-color: black;
      border-radius: 50%;
    }
    .mole {
      width: 30px;
      height: 80px;
      background-color: green;
      position: absolute;
      bottom: -100%;
      left: 50%;
      transform: translateX(-50%);
      transition: all 0.1s ease-in;
    }
  </style>
</head>
<body>
  <div class="container">
  </div>
  <script>
    class Mole {
      constructor(moleEl, actionIntervalMs, disappearAfterMs) {
        this.moleEl = moleEl
        this.actionIntervalMs = actionIntervalMs
        this.disappearAfterMs = disappearAfterMs
        this.interval = null
        this.timer = null
      }

      appear() {
        this.moleEl.style.bottom = 0
      }

      disappear() {
        this.moleEl.style.bottom = "-100%"
      }

      start() {
        this.interval = setInterval(() => {
          this.appear.bind(this)()
          this.timer = setTimeout(() => {
            this.disappear.bind(this)()
          }, this.disappearAfterMs)
        }, this.actionIntervalMs)
      }

      end() {
        clearTimeout(this.timer)
        clearInterval(this.interval)
        this.timer = null
        this.interval = null
      }
    }

    const container = document.querySelector(".container")
    // create holes and moles
    Array.from({length: 3}).forEach(obj => {
      const unit = document.createElement("div")
      unit.classList.add("unit")
      const hole = document.createElement("div")
      hole.classList.add("hole")
      const mole = document.createElement("div")
      mole.classList.add("mole")
      hole.appendChild(mole)
      unit.appendChild(hole)
      container.appendChild(unit)
    })

    let moles = []
    const moleEls = document.querySelectorAll(".mole")
    moleEls.forEach(moleEl => {
      const mole = new Mole(moleEl, 2000 + Math.random() * 3000, 2000)
      mole.start()
      moles.push(mole)
    })

    let hidden, visibilityChange;
    if (typeof document.hidden !== "undefined") {
      hidden = "hidden";
      visibilityChange = "visibilitychange";
    } else if (typeof document.msHidden !== "undefined") {
      hidden = "msHidden";
      visibilityChange = "msvisibilitychange";
    } else if (typeof document.webkitHidden !== "undefined") {
      hidden = "webkitHidden";
      visibilityChange = "webkitvisibilitychange";
    }

    document.addEventListener(visibilityChange, () => {
      if (document[hidden]) {
        moles.forEach(mole => {
          mole.end()
        })
        } else {
          moles.forEach(mole => {
            if (mole.interval === null || mole.timer === null) {
              mole.interval = setInterval(() => {
                mole.appear()
                mole.timer = setTimeout(() => {
                  mole.disappear()
                }, mole.disappearAfterMs)
              }, mole.actionIntervalMs)
            }
          })
        }
     })
  </script>
</body>
</html>